var select={};(function(){function e(a){var b=a.nextSibling;if(b){while(b.firstChild)b=b.firstChild;return b.nodeType==3||isBR(b)?b:e(b)}var c=a.parentNode;while(c&&!c.nextSibling)c=c.parentNode;return c&&e(c)}function b(b,c){while(!b.previousSibling&&b.parentNode!=c)b=b.parentNode;return a(b.previousSibling,c)}function a(a,b){while(a&&a.parentNode!=b)a=a.parentNode;return a}select.ie_selection=!(window.getSelection&&document.createRange&&document.createRange().endContainer);var c="\u00a0\u00a0\u00a0\u00a0";select.scrollToNode=function(a,b){if(!!a){var c=a,d=document.body,e=document.documentElement,f=!c.nextSibling||!c.nextSibling.nextSibling||!c.nextSibling.nextSibling.nextSibling,g=0;while(c&&!c.offsetTop)g++,c=c.previousSibling;g==0&&(f=!1);if(webkit&&c&&c.offsetTop==5&&c.offsetLeft==5)return;var h=g*(c?c.offsetHeight:0),i=0,j=a?a.offsetWidth:0,k=c;while(k&&k.offsetParent)h+=k.offsetTop,isBR(k)||(i+=k.offsetLeft),k=k.offsetParent;var l=d.scrollLeft||e.scrollLeft||0,m=d.scrollTop||e.scrollTop||0,n=!1,o=window.innerWidth||e.clientWidth||0;if(b||j<o){if(b){var p=select.offsetInNode(a),q=nodeText(a).length;q&&(i+=j*(p/q))}var r=i-l;if(r<0||r>o)l=i,n=!0}var s=h-m;if(s<0||f||s>(window.innerHeight||e.clientHeight||0)-50)m=f?1e6:h,n=!0;n&&window.scrollTo(l,m)}},select.scrollToCursor=function(a){select.scrollToNode(select.selectionTopNode(a,!0)||a.firstChild,!0)};var d=null;select.snapshotChanged=function(){d&&(d.changed=!0)},select.snapshotReplaceNode=function(a,b,c,f){function g(g){a==g.node?(d.changed=!0,c&&g.offset>c?g.offset-=c:(g.node=b,g.offset+=f||0)):select.ie_selection&&g.offset==0&&g.node==e(a)&&(d.changed=!0)}!d||(g(d.start),g(d.end))},select.snapshotMove=function(a,b,c,e,f){function g(g){a==g.node&&(!f||g.offset==0)&&(d.changed=!0,g.node=b,e?g.offset=Math.max(0,g.offset+c):g.offset=c)}!d||(g(d.start),g(d.end))};if(select.ie_selection){function f(){var a=document.selection;if(!a)return null;return a.createRange?a.createRange():a.createTextRange()}function g(a){function d(a){while(a&&a.firstChild)a=a.firstChild;return{node:a,offset:0}}function c(a){var b=null;while(!b&&a)b=a.nextSibling,a=a.parentNode;return d(b)}var b=f();b.collapse(a);var e=b.parentElement();if(!isAncestor(document.body,e))return null;if(!e.firstChild)return d(e);var g=b.duplicate();g.moveToElementText(e),g.collapse(!0);for(var h=e.firstChild;h;h=h.nextSibling){if(h.nodeType==3){var i=h.nodeValue.length;g.move("character",i)}else g.moveToElementText(h),g.collapse(!1);var j=b.compareEndPoints("StartToStart",g);if(j==0)return c(h);if(j==1)continue;if(h.nodeType!=3)return d(h);g.setEndPoint("StartToEnd",b);return{node:h,offset:i-g.text.length}}return c(e)}select.markSelection=function(){d=null;var a=document.selection;if(!!a){var b=g(!0),c=g(!1);if(!b||!c)return;d={start:b,end:c,changed:!1}}},select.selectMarked=function(){function a(a){var b=document.body.createTextRange(),c=a.node;if(!c)b.moveToElementText(document.body),b.collapse(!1);else if(c.nodeType==3){b.moveToElementText(c.parentNode);var d=a.offset;while(c.previousSibling)c=c.previousSibling,d+=(c.innerText||"").length;b.move("character",d)}else b.moveToElementText(c),b.collapse(!0);return b}if(!!d&&!!d.changed){var b=a(d.start),c=a(d.end);b.setEndPoint("StartToEnd",c),b.select()}},select.offsetInNode=function(a){var b=f();if(!b)return 0;var c=b.duplicate();try{c.moveToElementText(a)}catch(d){return 0}b.setEndPoint("StartToStart",c);return b.text.length},select.selectionTopNode=function(b,c){function h(a,b){if(b.nodeType==3){var c=0,d=b.previousSibling;while(d&&d.nodeType==3)c+=d.nodeValue.length,d=d.previousSibling;if(d){try{a.moveToElementText(d)}catch(e){return!1}a.collapse(!1)}else a.moveToElementText(b.parentNode);c&&a.move("character",c)}else try{a.moveToElementText(b)}catch(e){return!1}return!0}var d=f();if(!d)return!1;var e=d.duplicate();d.collapse(c);var g=d.parentElement();if(g&&isAncestor(b,g)){e.moveToElementText(g);if(d.compareEndPoints("StartToStart",e)==1)return a(g,b)}var c=0,i=b.childNodes.length-1;while(c<i){var j=Math.ceil((i+c)/2),k=b.childNodes[j];if(!k)return!1;if(!h(e,k))return!1;d.compareEndPoints("StartToStart",e)==1?c=j:i=j-1}if(c==0){var l=f(),m=l.duplicate();try{m.moveToElementText(b)}catch(n){return null}if(l.compareEndPoints("StartToStart",m)==0)return null}return b.childNodes[c]||null},select.focusAfterNode=function(a,b){var c=document.body.createTextRange();c.moveToElementText(a||b),c.collapse(!a),c.select()},select.somethingSelected=function(){var a=f();return a&&a.text!=""};function h(a){var b=f();b&&(b.pasteHTML(a),b.collapse(!1),b.select())}select.insertNewlineAtCursor=function(){h("<br>")},select.insertTabAtCursor=function(){h(c)},select.cursorPos=function(a,b){var c=f();if(!c)return null;var d=select.selectionTopNode(a,b);while(d&&!isBR(d))d=d.previousSibling;var e=c.duplicate();c.collapse(b);if(d)e.moveToElementText(d),e.collapse(!1);else{try{e.moveToElementText(a)}catch(g){return null}e.collapse(!0)}c.setEndPoint("StartToStart",e);return{node:d,offset:c.text.length}},select.setCursorPos=function(a,b,c){function d(b){var c=document.body.createTextRange();b.node?(c.moveToElementText(b.node),c.collapse(!1)):(c.moveToElementText(a),c.collapse(!0)),c.move("character",b.offset);return c}var e=d(b);c&&c!=b&&e.setEndPoint("EndToEnd",d(c)),e.select()},select.getBookmark=function(a){var b=select.cursorPos(a,!0),c=select.cursorPos(a,!1);if(b&&c)return{from:b,to:c}},select.setBookmark=function(a,b){!b||select.setCursorPos(a,b.from,b.to)}}else{function i(a,b){while(a.nodeType!=3&&!isBR(a)){var c=a.childNodes[b]||a.nextSibling;b=0;while(!c&&a.parentNode)a=a.parentNode,c=a.nextSibling;a=c;if(!c)break}return{node:a,offset:b}}select.markSelection=function(){var a=window.getSelection();if(!a||a.rangeCount==0)return d=null;var b=a.getRangeAt(0);d={start:i(b.startContainer,b.startOffset),end:i(b.endContainer,b.endOffset),changed:!1}},select.selectMarked=function(){function e(a,b){a.node?a.offset==0?c["set"+b+"Before"](a.node):c["set"+b](a.node,a.offset):c.setStartAfter(document.body.lastChild||document.body)}function b(){if(a.start.node==a.end.node&&a.start.offset==a.end.offset){var b=window.getSelection();if(!b||b.rangeCount==0)return!0;var c=b.getRangeAt(0),d=i(c.startContainer,c.startOffset);return a.start.node!=d.node||a.start.offset!=d.offset}}var a=d;if(!!a&&!!(a.changed||webkit&&b())){var c=document.createRange();e(a.end,"End"),e(a.start,"Start"),j(c)}};function j(a){var b=window.getSelection();!b||(b.removeAllRanges(),b.addRange(a))}function k(){var a=window.getSelection();return!a||a.rangeCount==0?!1:a.getRangeAt(0)}select.selectionTopNode=function(c,d){var e=k();if(!e)return!1;var f=d?e.startContainer:e.endContainer,g=d?e.startOffset:e.endOffset;window.opera&&!d&&e.endContainer==c&&e.endOffset==e.startOffset+1&&c.childNodes[e.startOffset]&&isBR(c.childNodes[e.startOffset])&&g--;return f.nodeType==3?g>0?a(f,c):b(f,c):f.nodeName.toUpperCase()=="HTML"?g==1?null:c.lastChild:f==c?g==0?null:f.childNodes[g-1]:g==f.childNodes.length?a(f,c):g==0?b(f,c):a(f.childNodes[g-1],c)},select.focusAfterNode=function(a,b){var c=document.createRange();c.setStartBefore(b.firstChild||b),a&&!a.firstChild?c.setEndAfter(a):a?c.setEnd(a,a.childNodes.length):c.setEndBefore(b.firstChild||b),c.collapse(!1),j(c)},select.somethingSelected=function(){var a=k();return a&&!a.collapsed},select.offsetInNode=function(a){var b=k();if(!b)return 0;b=b.cloneRange(),b.setStartBefore(a);return b.toString().length},select.insertNodeAtCursor=function(a){var b=k();if(!!b){b.deleteContents(),b.insertNode(a),webkitLastLineHack(document.body);if(window.opera&&isBR(a)&&isSpan(a.parentNode)){var c=a.nextSibling,d=a.parentNode,e=d.parentNode;e.insertBefore(a,d.nextSibling);var f="";for(;c&&c.nodeType==3;c=c.nextSibling)f+=c.nodeValue,removeElement(c);e.insertBefore(makePartSpan(f,document),a.nextSibling)}b=document.createRange(),b.selectNode(a),b.collapse(!1),j(b)}},select.insertNewlineAtCursor=function(){select.insertNodeAtCursor(document.createElement("BR"))},select.insertTabAtCursor=function(){select.insertNodeAtCursor(document.createTextNode(c))},select.cursorPos=function(a,b){var c=k();if(!!c){var d=select.selectionTopNode(a,b);while(d&&!isBR(d))d=d.previousSibling;c=c.cloneRange(),c.collapse(b),d?c.setStartAfter(d):c.setStartBefore(a);var e=c.toString();return{node:d,offset:e.length}}},select.setCursorPos=function(a,b,c){function e(b,c,e){function g(a){a.nodeType==3?f.push(a):forEach(a.childNodes,g)}if(c==0&&b&&!b.nextSibling){d["set"+e+"After"](b);return!0}b?b=b.nextSibling:b=a.firstChild;if(!!b){if(c==0){d["set"+e+"Before"](b);return!0}var f=[];for(;;){while(b&&!f.length)g(b),b=b.nextSibling;var h=f.shift();if(!h)return!1;var i=h.nodeValue.length;if(i>=c){d["set"+e](h,c);return!0}c-=i}}}var d=document.createRange();c=c||b,e(c.node,c.offset,"End")&&e(b.node,b.offset,"Start")&&j(d)}}})()