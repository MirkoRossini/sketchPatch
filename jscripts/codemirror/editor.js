function asEditorLines(a){var b=makeWhiteSpace(indentUnit);return map(a.replace(/\t/g,b).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}function alwaysZero(){return 0}function makePartSpan(a){var b=a;a.nodeType==3?b=a.nodeValue:a=document.createTextNode(b);var c=document.createElement("span");c.isPart=!0,c.appendChild(a),c.currentText=b;return c}function cleanText(a){return a.replace(/\u00a0/g," ").replace(/\u200b/g,"")}function fixSpaces(a){a.charAt(0)==" "&&(a=nbsp+a.slice(1));return a.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(a){return makeWhiteSpace(a.length)})}function makeWhiteSpace(a){var b=[],c=!0;for(;a>0;a--)b.push(c||a==1?nbsp:" "),c^=!0;return b.join("")}var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),oldIE=internetExplorer&&/MSIE\s+[4-8]\b/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computer, Inc/.test(navigator.vendor),gecko=navigator.userAgent.match(/gecko\/(\d{8})/i);gecko&&(gecko=Number(gecko[1]));var mac=/Mac/.test(navigator.platform),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent),slowWebkit=/AppleWebKit\/533/.test(navigator.userAgent),webkitLastLineHack=webkit?function(a){var b=a.lastChild;if(!b||!b.hackBR){var c=document.createElement("br");c.hackBR=!0,a.appendChild(c)}}:function(){},Editor=function(){function j(a){return a>=16&&a<=18||a>=33&&a<=40}function i(a){this.options=a,window.indentUnit=a.indentUnit;var b=this.container=document.body;this.history=new UndoHistory(b,a.undoDepth,a.undoDelay,this);var c=this;if(!i.Parser)throw"No parser loaded.";a.parserConfig&&i.Parser.configure&&i.Parser.configure(a.parserConfig),!a.readOnly&&!internetExplorer&&select.setCursorPos(b,{node:null,offset:0}),this.dirty=[],this.importCode(a.content||""),this.history.onChange=a.onChange;if(!a.readOnly){a.continuousScanning!==!1&&(this.scanner=this.documentScanner(a.passTime),this.delayScanning());function d(){document.body.contentEditable!=undefined&&internetExplorer?document.body.contentEditable="true":document.designMode="on",internetExplorer&&a.height!="dynamic"&&(document.body.style.minHeight=window.frameElement.clientHeight-2*document.body.offsetTop-5+"px"),document.documentElement.style.borderWidth="0",a.textWrapping||(b.style.whiteSpace="nowrap")}try{d()}catch(e){var f=addEventHandler(document,"focus",function(){f(),d()},!0)}addEventHandler(document,"keydown",method(this,"keyDown")),addEventHandler(document,"keypress",method(this,"keyPress")),addEventHandler(document,"keyup",method(this,"keyUp"));function g(){c.cursorActivity(!1)}addEventHandler(internetExplorer?document.body:window,"mouseup",g),addEventHandler(document.body,"cut",g),gecko&&addEventHandler(window,"pagehide",function(){c.unloaded=!0}),addEventHandler(document.body,"paste",function(a){g();var b=null;try{var d=a.clipboardData||window.clipboardData;d&&(b=d.getData("Text"))}catch(e){}b!==null&&(a.stop(),c.replaceSelection(b),select.scrollToCursor(c.container))}),this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}else a.textWrapping||(b.style.whiteSpace="nowrap")}function h(a,b,c,d){function e(b){var c=cleanText(a.history.textAfter(b));return d?c.toLowerCase():c}this.editor=a,this.history=a.history,this.history.commit(),this.valid=!!b,this.atOccurrence=!1,d==undefined&&(d=typeof b=="string"&&b==b.toLowerCase());var f={node:null,offset:0},g=this;if(c&&typeof c=="object"&&typeof c.character=="number"){a.checkLine(c.line);var h={node:c.line,offset:c.character};this.pos={from:h,to:h}}else c?this.pos={from:select.cursorPos(a.container,!0)||f,to:select.cursorPos(a.container,!1)||f}:this.pos={from:f,to:f};if(typeof b!="string")this.matches=function(a,c,d){if(a){var f=e(c).slice(0,d),h=f.match(b),i=0;while(h){var j=f.indexOf(h[0]);i+=j,f=f.slice(j+1);var k=f.match(b);if(k)h=k;else break}}else var f=e(c).slice(d),h=f.match(b),i=h&&d+f.indexOf(h[0]);if(h){g.currentMatch=h;return{from:{node:c,offset:i},to:{node:c,offset:i+h[0].length}}}};else{d&&(b=b.toLowerCase());var i=b.split("\n");this.matches=i.length==1?function(a,c,d){var f=e(c),g=b.length,h;if(a?d>=g&&(h=f.lastIndexOf(b,d-g))!=-1:(h=f.indexOf(b,d))!=-1)return{from:{node:c,offset:h},to:{node:c,offset:h+g}}}:function(a,b,c){var d=a?i.length-1:0,f=i[d],g=e(b),h=a?g.indexOf(f)+f.length:g.lastIndexOf(f);if(!(a?h>=c||h!=f.length:h<=c||h!=g.length-f.length)){var j=b;for(;;){if(a&&!j)return;j=a?this.history.nodeBefore(j):this.history.nodeAfter(j);if(!a&&!j)return;g=e(j),f=i[a?--d:++d];if(d>0&&d<i.length-1){if(g!=f)return;continue}var k=a?g.lastIndexOf(f):g.indexOf(f)+f.length;if(a?k!=g.length-f.length:k!=f.length)return;return{from:{node:a?j:b,offset:a?k:h},to:{node:a?b:j,offset:a?h:k}}}}}}}function g(){return(new Date).getTime()}function f(a,b){a?isBR(a)&&(a=a.nextSibling):a=b.firstChild;while(a&&!isBR(a))a=a.nextSibling;return a}function e(a){while(a&&!isBR(a))a=a.previousSibling;return a}function d(a){return isBR(a)?1:a.currentText.length}function c(a){function j(){if(!a)throw StopIteration;var b=a;a=b.nextSibling;if(i(b)){c.push(b),f=!1;return b.currentText}if(isBR(b)){f&&window.opera&&b.parentNode.insertBefore(makePartSpan(""),b),c.push(b),f=!0;return"\n"}var g=!b.nextSibling;e=d(b),removeElement(b);return h(b,g)}function i(a){if(a.isPart&&a.childNodes.length==1&&a.firstChild.nodeType==3){var b=a.firstChild.nodeValue;a.dirty=a.dirty||b!=a.currentText,a.currentText=b;return!/[\n\t\r]/.test(a.currentText)}return!1}function h(a,c){var d=b(a,c);for(var e=0;e<d.length;e++)d[e]=g(d[e]);return d.join("")}function g(a){var b="\n";a.nodeType==3?(select.snapshotChanged(),a=makePartSpan(a),b=a.currentText,f=!1):(f&&window.opera&&e(makePartSpan("")),f=!0),a.dirty=!0,c.push(a),e(a);return b}function d(a){var b=a.parentNode,c=a.nextSibling;return function(a){b.insertBefore(a,c)}}var c=[],e=null,f=!0;return{next:j,nodes:c}}function b(b,c){function f(b,g){if(b.nodeType==3){var h=b.nodeValue=fixSpaces(b.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "));h.length&&(e=!1),d.push(b)}else if(isBR(b)&&b.childNodes.length==0)e=!0,d.push(b);else{for(var i=b.firstChild;i;i=i.nextSibling)f(i);!e&&a.hasOwnProperty(b.nodeName.toUpperCase())&&(e=!0,(!c||!g)&&d.push(document.createElement("br")))}}var d=[],e=!0;f(b,!0);return d}var a={P:!0,DIV:!0,LI:!0};h.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function f(){var a={node:d,offset:e};b.pos={from:a,to:a},b.atOccurrence=!1;return!1}if(!this.valid)return!1;var b=this,c=a?this.pos.from:this.pos.to,d=c.node,e=c.offset;d&&!d.parentNode&&(d=null,e=0);for(;;){if(this.pos=this.matches(a,d,e)){this.atOccurrence=!0;return!0}if(a){if(!d)return f();d=this.history.nodeBefore(d),e=this.history.textAfter(d).length}else{var g=this.history.nodeAfter(d);if(!g){e=this.history.textAfter(d).length;return f()}d=g,e=0}}},select:function(){this.atOccurrence&&(select.setCursorPos(this.editor.container,this.pos.from,this.pos.to),select.scrollToCursor(this.editor.container))},replace:function(a){if(this.atOccurrence){var b=this.currentMatch;b&&(a=a.replace(/\\(\d)/,function(a,c){return b[c]}));var c=this.editor.replaceRange(this.pos.from,this.pos.to,a);this.pos.to=c,this.atOccurrence=!1}},position:function(){if(this.atOccurrence)return{line:this.pos.from.node,character:this.pos.from.offset}}},i.prototype={importCode:function(a){var b=asEditorLines(a),c=1e3;if(!this.options.incrementalLoading||b.length<c)this.history.push(null,null,b),this.history.reset();else{var d=0,e=this;function f(){var a=b.slice(d,d+c);a.push(""),e.history.push(e.history.nodeBefore(null),null,a),e.history.reset(),d+=c,d<b.length&&parent.setTimeout(f,1e3)}f()}},getCode:function(){if(!this.container.firstChild)return"";var a=[];select.markSelection(),forEach(c(this.container.firstChild),method(a,"push")),select.selectMarked(),webkit&&this.container.lastChild.hackBR&&a.pop(),webkitLastLineHack(this.container);return cleanText(a.join(""))},checkLine:function(a){if(a===!1||a!=null&&a.parentNode!=this.container&&!a.hackBR)throw parent.CodeMirror.InvalidLineHandle},cursorPosition:function(a){a==null&&(a=!0);var b=select.cursorPos(this.container,a);return b?{line:b.node,character:b.offset}:{line:null,character:0}},firstLine:function(){return null},lastLine:function(){var a=this.container.lastChild;a&&(a=e(a)),a&&a.hackBR&&(a=e(a.previousSibling));return a},nextLine:function(a){this.checkLine(a);var b=f(a,this.container);return!b||b.hackBR?!1:b},prevLine:function(a){this.checkLine(a);if(a==null)return!1;return e(a.previousSibling)},visibleLineCount:function(){var a=this.container.firstChild;while(a&&isBR(a))a=a.nextSibling;if(!a)return!1;var b=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return Math.floor(b/a.offsetHeight)},selectLines:function(a,b,c,d){this.checkLine(a);var e={node:a,offset:b},f=null;d!==undefined&&(this.checkLine(c),f={node:c,offset:d}),select.setCursorPos(this.container,e,f),select.scrollToCursor(this.container)},lineContent:function(a){var b=[];for(a=a?a.nextSibling:this.container.firstChild;a&&!isBR(a);a=a.nextSibling)b.push(nodeText(a));return cleanText(b.join(""))},setLineContent:function(a,b){this.history.commit(),this.replaceRange({node:a,offset:0},{node:a,offset:this.history.textAfter(a).length},b),this.addDirtyNode(a),this.scheduleHighlight()},removeLine:function(a){var b=a?a.nextSibling:this.container.firstChild;while(b){var c=b.nextSibling;removeElement(b);if(isBR(b))break;b=c}this.addDirtyNode(a),this.scheduleHighlight()},insertIntoLine:function(a,b,c){var d=null;if(b=="end")d=f(a,this.container);else for(var e=a?a.nextSibling:this.container.firstChild;e;e=e.nextSibling){if(b==0){d=e;break}var g=nodeText(e);if(g.length>b){d=e.nextSibling,c=g.slice(0,b)+c+g.slice(b),removeElement(e);break}b-=g.length}var h=asEditorLines(c);for(var i=0;i<h.length;i++)i>0&&this.container.insertBefore(document.createElement("BR"),d),this.container.insertBefore(makePartSpan(h[i]),d);this.addDirtyNode(a),this.scheduleHighlight()},selectedText:function(){var a=this.history;a.commit();var b=select.cursorPos(this.container,!0),c=select.cursorPos(this.container,!1);if(!b||!c)return"";if(b.node==c.node)return a.textAfter(b.node).slice(b.offset,c.offset);var d=[a.textAfter(b.node).slice(b.offset)];for(var e=a.nodeAfter(b.node);e!=c.node;e=a.nodeAfter(e))d.push(a.textAfter(e));d.push(a.textAfter(c.node).slice(0,c.offset));return cleanText(d.join("\n"))},replaceSelection:function(a){this.history.commit();var b=select.cursorPos(this.container,!0),c=select.cursorPos(this.container,!1);!!b&&!!c&&(c=this.replaceRange(b,c,a),select.setCursorPos(this.container,c),webkitLastLineHack(this.container))},cursorCoords:function(a,b){function h(a,b){var c=document.createElement("SPAN");c.appendChild(document.createTextNode(a));try{return b(c)}finally{c.parentNode&&c.parentNode.removeChild(c)}}function g(a,c){var d=-(document.body.scrollTop||document.documentElement.scrollTop||0),e=-(document.body.scrollLeft||document.documentElement.scrollLeft||0)+c;forEach([a,b?null:window.frameElement],function(a){while(a)e+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent});return{x:e,y:d,yBot:d+a.offsetHeight}}var c=select.cursorPos(this.container,a);if(!c)return null;var d=c.offset,e=c.node,f=this;while(d){e=e?e.nextSibling:this.container.firstChild;var i=nodeText(e);if(d<i.length)return h(i.substr(0,d),function(a){a.style.position="absolute",a.style.visibility="hidden",a.className=e.className,f.container.appendChild(a);return g(e,a.offsetWidth)});d-=i.length}return e&&isSpan(e)?g(e,e.offsetWidth):e&&e.nextSibling&&isSpan(e.nextSibling)?g(e.nextSibling,0):h("\u200b",function(a){e?e.parentNode.insertBefore(a,e.nextSibling):f.container.insertBefore(a,f.container.firstChild);return g(a,0)})},reroutePasteEvent:function(){if(!(this.capturingPaste||window.opera||gecko&&gecko>=20101026)){this.capturingPaste=!0;var a=window.frameElement.CodeMirror.textareaHack,b=this.cursorCoords(!0,!0);a.style.top=b.y+"px";if(oldIE){var c=select.getBookmark(this.container);c&&(this.selectionSnapshot=c)}parent.focus(),a.value="",a.focus();var d=this;parent.setTimeout(function(){d.capturingPaste=!1,window.focus(),d.selectionSnapshot&&window.select.setBookmark(d.container,d.selectionSnapshot);var b=a.value;b&&(d.replaceSelection(b),select.scrollToCursor(d.container))},10)}},replaceRange:function(a,b,c){var d=asEditorLines(c);d[0]=this.history.textAfter(a.node).slice(0,a.offset)+d[0];var e=d[d.length-1];d[d.length-1]=e+this.history.textAfter(b.node).slice(b.offset);var f=this.history.nodeAfter(b.node);this.history.push(a.node,f,d);return{node:this.history.nodeBefore(f),offset:e.length}},getSearchCursor:function(a,b,c){return new h(this,a,b,c)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(a){if(!select.somethingSelected())this.indentAtCursor(a);else{var b=select.selectionTopNode(this.container,!0),c=select.selectionTopNode(this.container,!1);if(b===!1||c===!1)return;this.indentRegion(b,c,a,!0)}},grabKeys:function(a,b){this.frozen=a,this.keyFilter=b},ungrabKeys:function(){this.frozen="leave"},setParser:function(a,b){i.Parser=window[a],b=b||this.options.parserConfig,b&&i.Parser.configure&&i.Parser.configure(b),this.container.firstChild&&(forEach(this.container.childNodes,function(a){a.nodeType!=3&&(a.dirty=!0)}),this.addDirtyNode(this.firstChild),this.scheduleHighlight())},keyDown:function(a){this.frozen=="leave"&&(this.frozen=null,this.keyFilter=null);if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode,a)))a.stop(),this.frozen(a);else{var b=a.keyCode;this.delayScanning(),this.options.autoMatchParens&&this.scheduleParenHighlight();if(b==13){if(a.ctrlKey&&!a.altKey)this.reparseBuffer();else{select.insertNewlineAtCursor();var c=this.options.enterMode;c!="flat"&&this.indentAtCursor(c=="keep"?"keep":undefined),select.scrollToCursor(this.container)}a.stop()}else if(b==9&&this.options.tabMode!="default"&&!a.ctrlKey)this.handleTab(!a.shiftKey),a.stop();else if(b==32&&a.shiftKey&&this.options.tabMode=="default")this.handleTab(!0),a.stop();else if(b==36&&!a.shiftKey&&!a.ctrlKey)this.home()&&a.stop();else if(b==35&&!a.shiftKey&&!a.ctrlKey)this.end()&&a.stop();else if(b==33&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageUp()&&a.stop();else if(b==34&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageDown()&&a.stop();else if((b==219||b==221)&&a.ctrlKey&&!a.altKey)this.highlightParens(a.shiftKey,!0),a.stop();else if(a.metaKey&&!a.shiftKey&&(b==37||b==39)){var d=select.selectionTopNode(this.container);if(d===!1||!this.container.firstChild)return;if(b==37)select.focusAfterNode(e(d),this.container);else{var g=f(d,this.container);select.focusAfterNode(g?g.previousSibling:this.container.lastChild,this.container)}a.stop()}else(a.ctrlKey||a.metaKey)&&!a.altKey&&(a.shiftKey&&b==90||b==89?(select.scrollToNode(this.history.redo()),a.stop()):b==90||safari&&b==8?(select.scrollToNode(this.history.undo()),a.stop()):b==83&&this.options.saveFunction?(this.options.saveFunction(),a.stop()):b==86&&!mac&&this.reroutePasteEvent())}},keyPress:function(a){var b=this.options.electricChars&&i.Parser.electricChars,c=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode||a.code,a))||a.code==13||a.code==9&&this.options.tabMode!="default"||a.code==32&&a.shiftKey&&this.options.tabMode=="default")a.stop();else if(mac&&(a.ctrlKey||a.metaKey)&&a.character=="v")this.reroutePasteEvent();else if(b&&b.indexOf(a.character)!=-1)parent.setTimeout(function(){c.indentAtCursor(null)},0);else if(brokenOpera){if(a.code==8){var d=select.selectionTopNode(this.container),c=this,e=d?d.nextSibling:this.container.firstChild;d!==!1&&e&&isBR(e)&&parent.setTimeout(function(){select.selectionTopNode(c.container)==e&&select.focusAfterNode(e.previousSibling,c.container)},20)}else if(a.code==46){var d=select.selectionTopNode(this.container),c=this;d&&isBR(d)&&parent.setTimeout(function(){select.selectionTopNode(c.container)!=d&&select.focusAfterNode(d,c.container)},20)}}else if(slowWebkit){var d=select.selectionTopNode(this.container),e=d?d.nextSibling:this.container.firstChild;if(d&&e&&isBR(e)&&!isBR(d)){var f=document.createTextNode("\u200b");this.container.insertBefore(f,e),parent.setTimeout(function(){f.nodeValue=="\u200b"?removeElement(f):f.nodeValue=f.nodeValue.replace("\u200b","")},20)}}webkit&&!this.options.textWrapping&&setTimeout(function(){var a=select.selectionTopNode(c.container,!0);a&&a.nodeType==3&&a.previousSibling&&isBR(a.previousSibling)&&a.nextSibling&&isBR(a.nextSibling)&&a.parentNode.replaceChild(document.createElement("BR"),a.previousSibling)},50)},keyUp:function(a){this.cursorActivity(j(a.keyCode))},indentLineAfter:function(a,b){function c(a){var b=a?a.nextSibling:d.container.firstChild;if(!b||!hasClass(b,"whitespace"))return null;return b}var d=this,f=c(a),g=0,h=f?f.currentText.length:0,j=f?f.nextSibling:a?a.nextSibling:this.container.firstChild;if(b=="keep"){if(a){var k=c(e(a.previousSibling));k&&(g=k.currentText.length)}}else{var l=a&&j&&j.currentText?j.currentText:"";b!=null&&this.options.tabMode!="indent"?g=b?h+indentUnit:Math.max(0,h-indentUnit):a?g=a.indentation(l,h,b,j):i.Parser.firstIndentation&&(g=i.Parser.firstIndentation(l,h,b,j))}var m=g-h;m<0?g==0?(j&&select.snapshotMove(f.firstChild,j.firstChild||j,0),removeElement(f),f=null):(select.snapshotMove(f.firstChild,f.firstChild,m,!0),f.currentText=makeWhiteSpace(g),f.firstChild.nodeValue=f.currentText):m>0?f?(f.currentText=makeWhiteSpace(g),f.firstChild.nodeValue=f.currentText,select.snapshotMove(f.firstChild,f.firstChild,m,!0)):(f=makePartSpan(makeWhiteSpace(g)),f.className="whitespace",a?insertAfter(f,a):this.container.insertBefore(f,this.container.firstChild),select.snapshotMove(j&&(j.firstChild||j),f.firstChild,g,!1,!0)):f&&select.snapshotMove(f.firstChild,f.firstChild,g,!1),m!=0&&this.addDirtyNode(a)},highlightAtCursor:function(){var a=select.selectionTopNode(this.container,!0),b=select.selectionTopNode(this.container,!1);if(a===!1||b===!1)return!1;select.markSelection();if(this.highlight(a,f(b,this.container),!0,20)===!1)return!1;select.selectMarked();return!0},handleTab:function(a){this.options.tabMode=="spaces"&&!select.somethingSelected()?select.insertTabAtCursor():this.reindentSelection(a)},home:function(){var a=select.selectionTopNode(this.container,!0),b=a;if(a===!1||!(!a||a.isPart||isBR(a))||!this.container.firstChild)return!1;while(a&&!isBR(a))a=a.previousSibling;var c=a?a.nextSibling:this.container.firstChild;c&&c!=b&&c.isPart&&hasClass(c,"whitespace")?select.focusAfterNode(c,this.container):select.focusAfterNode(a,this.container),select.scrollToCursor(this.container);return!0},end:function(){var a=select.selectionTopNode(this.container,!0);if(a===!1)return!1;a=f(a,this.container);if(!a)return!1;select.focusAfterNode(a.previousSibling,this.container),select.scrollToCursor(this.container);return!0},pageUp:function(){var a=this.cursorPosition().line,b=this.visibleLineCount();if(a===!1||b===!1)return!1;b-=2;for(var c=0;c<b;c++){a=this.prevLine(a);if(a===!1)break}if(c==0)return!1;select.setCursorPos(this.container,{node:a,offset:0}),select.scrollToCursor(this.container);return!0},pageDown:function(){var a=this.cursorPosition().line,b=this.visibleLineCount();if(a===!1||b===!1)return!1;b-=2;for(var c=0;c<b;c++){var d=this.nextLine(a);if(d===!1)break;a=d}if(c==0)return!1;select.setCursorPos(this.container,{node:a,offset:0}),select.scrollToCursor(this.container);return!0},scheduleParenHighlight:function(){this.parenEvent&&parent.clearTimeout(this.parenEvent);var a=this;this.parenEvent=parent.setTimeout(function(){a.highlightParens()},300)},highlightParens:function(a,b){function o(){var a=[],b,c=!0;for(var d=k;d;d=m?d.nextSibling:d.previousSibling)if(d.className==l&&isSpan(d)&&(b=h(d))){i(b)==m?a.push(b):a.length?a.pop()!=matching[b]&&(c=!1):c=!1;if(!a.length)break}else if(d.dirty||!isSpan(d)&&!isBR(d))return{node:d,status:"dirty"};return{node:d,status:d&&c}}function i(a){return/[\(\[\{]/.test(a)}function h(a){if(a.currentText){var b=a.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return b&&b[1]}}function g(a){!a||(d&&!d.call?removeClass(removeClass(a,d[0]),d[1]):c.options.unmarkParen?c.options.unmarkParen(a):(a.style.fontWeight="",a.style.color=""))}function e(a,b){!a||(d?d.call?d(a,b):a.className+=" "+d[b?0:1]:(a.style.fontWeight="bold",a.style.color=b?"#8F8":"#F88"))}var c=this,d=this.options.markParen;typeof d=="string"&&(d=[d,d]),!b&&c.highlighted&&(g(c.highlighted[0]),g(c.highlighted[1]));if(!(!window||!window.parent||!window.select)){this.parenEvent&&parent.clearTimeout(this.parenEvent),this.parenEvent=null;var j,k=select.selectionTopNode(this.container,!0);if(!k||!this.highlightAtCursor())return;k=select.selectionTopNode(this.container,!0);if(!k||!((j=h(k))||(k=k.nextSibling)&&(j=h(k))))return;var l=k.className,m=i(j),n=matching[j];for(;;){var p=o();if(p.status=="dirty"){this.highlight(p.node,f(p.node)),p.node.dirty=!1;continue}e(k,p.status),e(p.node,p.status),b?parent.setTimeout(function(){g(k),g(p.node)},500):c.highlighted=[k,p.node],a&&p.node&&select.focusAfterNode(p.node.previousSibling,this.container);break}}},indentAtCursor:function(a){if(!!this.container.firstChild){if(!this.highlightAtCursor())return;var b=select.selectionTopNode(this.container,!1);if(b===!1)return;select.markSelection(),this.indentLineAfter(e(b),a),select.selectMarked()}},indentRegion:function(a,b,c,d){var g=a=e(a),h=a&&e(a.previousSibling);isBR(b)||(b=f(b,this.container)),this.addDirtyNode(a);do{var i=f(g,this.container);g&&this.highlight(h,i,!0),this.indentLineAfter(g,c),h=g,g=i}while(g!=b);d&&select.setCursorPos(this.container,{node:a,offset:0},{node:b,offset:0})},cursorActivity:function(a){this.unloaded&&(window.document.designMode="off",window.document.designMode="on",this.unloaded=!1);if(oldIE){this.container.createTextRange().execCommand("unlink"),clearTimeout(this.saveSelectionSnapshot);var b=this;this.saveSelectionSnapshot=setTimeout(function(){var a=select.getBookmark(b.container);a&&(b.selectionSnapshot=a)},200)}var c=this.options.onCursorActivity;if(!a||c){var d=select.selectionTopNode(this.container,!1);if(d===!1||!this.container.firstChild)return;d=d||this.container.firstChild,c&&c(d),a||(this.scheduleHighlight(),this.addDirtyNode(d))}},reparseBuffer:function(){forEach(this.container.childNodes,function(a){a.dirty=!0}),this.container.firstChild&&this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(a){a=a||this.container.firstChild;if(!!a){for(var b=0;b<this.dirty.length;b++)if(this.dirty[b]==a)return;a.nodeType!=3&&(a.dirty=!0),this.dirty.push(a)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var a=this;parent.clearTimeout(this.highlightTimeout),this.highlightTimeout=parent.setTimeout(function(){a.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){while(this.dirty.length>0){var a=this.dirty.pop();try{while(a&&a.parentNode!=this.container)a=a.parentNode;if(a&&(a.dirty||a.nodeType==3))return a}catch(b){}}return null},highlightDirty:function(a){if(!window||!window.parent||!window.select)return!1;this.options.readOnly||select.markSelection();var b,c=a?null:g()+this.options.passTime;while((g()<c||a)&&(b=this.getDirtyNode())){var d=this.highlight(b,c);d&&d.node&&d.dirty&&this.addDirtyNode(d.node.nextSibling)}this.options.readOnly||select.selectMarked(),b&&this.scheduleHighlight();return this.dirty.length==0},documentScanner:function(a){var b=this,c=null;return function(){if(!(!window||!window.parent||!window.select)){c&&c.parentNode!=b.container&&(c=null),select.markSelection();var d=b.highlight(c,g()+a,!0);select.selectMarked();var e=d?d.node&&d.node.nextSibling:null;c=c==e?null:e,b.delayScanning()}}},delayScanning:function(){this.scanner&&(parent.clearTimeout(this.documentScan),this.documentScan=parent.setTimeout(this.scanner,this.options.continuousScanning))},highlight:function(a,b,d,e){function s(a){return(a.previousSibling==null||isBR(a.previousSibling))&&(a.nextSibling==null||isBR(a.nextSibling))}function o(a){if(a){var b=a.oldNextSibling;(u||b===undefined||a.nextSibling!=b)&&h.history.touch(a),a.oldNextSibling=a.nextSibling}else{var b=h.container.oldFirstChild;(u||b===undefined||h.container.firstChild!=b)&&h.history.touch(null),h.container.oldFirstChild=h.container.firstChild}}function n(a){var b=makePartSpan(a.value);b.className=a.style;return b}function m(a,b){a.currentText=a.currentText.substring(b),a.reduced=!0}function l(a,b){return!b.reduced&&b.currentText==a.value&&b.className==a.style}var f=this.container,h=this,j=this.options.activeTokens,k=typeof b=="number"?b:null;if(!f.firstChild)return!1;while(a&&(!a.parserFromHere||a.dirty)){if(e!=null&&isBR(a)&&--e<0)return!1;a=a.previousSibling}if(a&&!a.nextSibling)return!1;var p=c(a?a.nextSibling:f.firstChild),q=stringStream(p),r=a?a.parserFromHere(q):i.Parser.make(q),t={current:null,get:function(){this.current||(this.current=p.nodes.shift());return this.current},next:function(){this.current=null},remove:function(){f.removeChild(this.get()),this.current=null},getNonEmpty:function(){var a=this.get();while(a&&isSpan(a)&&a.currentText=="")if(window.opera&&s(a))this.next(),a=this.get();else{var b=a;this.remove(),a=this.get(),select.snapshotMove(b.firstChild,a&&(a.firstChild||a),0)}return a}},u=!1,v=!0,w=0;forEach(r,function(c){var e=t.getNonEmpty();if(c.value=="\n"){if(!isBR(e))throw"Parser out of sync. Expected BR.";if(e.dirty||!e.indentation)u=!0;o(a),a=e,e.parserFromHere=r.copy(),e.indentation=c.indentation||alwaysZero,e.dirty=!1;if(k==null&&e==b)throw StopIteration;if(k!=null&&g()>=k||!u&&!v&&w>1&&!d)throw StopIteration;v=u,u=!1,w=0,t.next()}else{if(!isSpan(e))throw"Parser out of sync. Expected SPAN.";e.dirty&&(u=!0),w++;if(l(c,e))j&&e.dirty&&j(e,c,h),e.dirty=!1,t.next();else{u=!0;var i=n(c);f.insertBefore(i,e),j&&j(i,c,h);var p=c.value.length,q=0;while(p>0){e=t.get();var s=e.currentText.length;select.snapshotReplaceNode(e.firstChild,i.firstChild,p,q),s>p?(m(e,p),p=0):(p-=s,q+=s,t.remove())}}}}),o(a),webkitLastLineHack(this.container);return{node:t.getNonEmpty(),dirty:u}}};return i}();addEventHandler(window,"load",function(){var a=window.frameElement.CodeMirror,b=a.editor=new Editor(a.options);parent.setTimeout(method(a,"init"),0)})